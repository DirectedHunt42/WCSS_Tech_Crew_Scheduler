<!DOCTYPE html>
<html lang="en">
<!--
    This HTML file provides an admin login page for the WCSS Tech Crew Scheduler.
    It includes styling, theme switching, and a login form that submits credentials to an API endpoint.
-->
<style>
    /* Center the content vertically and horizontally */
    body {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
    }

    /* Style the form and its elements */
    form {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-top: 50px;
    }

    label,
    input,
    button {
        margin: 10px;
    }

    input {
        width: 200px;
        padding: 10px;
        font-size: 12px;
    }

    button {
        width: 94%;
        padding: 10px;
        font-size: 12px;
    }

    .button-row {
        display: flex;
        justify-content: center;
        width: 300px;
    }

    h1 {
        font-size: 3rem;
        text-align: center;
    }
</style>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WCSS Tech Admin Login</title>
    <!-- Default dark theme stylesheet -->
    <link rel="stylesheet" href="/CSS/DarkStyle.css">
    <!-- Favicon for the page -->
    <link rel="icon" type="image/x-icon" href="/FavIcon.ico">
    <!-- Script for authentication logic -->
    <script src="/JS/authClient.js"></script>
    <!-- Script for theme switching functionality -->
    <script src="/JS/themeHandler.js" defer></script>
    <style>
        /* Position the theme switcher in the top-right corner */
        #theme-switcher {
            position: absolute;
            top: 0px;
            right: 0px;
        }
    </style>
    <script>
        import { apiBase } from './apiBase.js';
        // Wait for the DOM to load before attaching event listeners
        document.addEventListener("DOMContentLoaded", () => {
            const loginForm = document.getElementById("login-form");
            const errorMessage = document.getElementById("error-message");

            // Handle login form submission
            loginForm.addEventListener("submit", async (event) => {
                event.preventDefault(); // Prevent default form submission

                // Get username and password values
                const username = document.getElementById("username").value;
                const password = document.getElementById("password").value;

                try {
                    // Construct API endpoint based on current origin
                    const response = await fetch(`${apiBase}/api/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        credentials: 'include',
                        body: JSON.stringify({ username, password, type: 'admin' })
                    });

                    const result = await response.json();

                    if (response.ok) {
                        // On successful login, redirect to admin page
                        console.log("Login successful:", result);
                        window.location.href = "/AdminPage/AdminPage.html";
                    } else {
                        // Show error message from server
                        errorMessage.textContent = result.error || "Login failed";
                        errorMessage.style.display = "block";
                    }
                } catch (error) {
                    // Handle network or other errors
                    console.error("Error:", error);
                    errorMessage.textContent = "An error occurred. Please try again.";
                    errorMessage.style.display = "block";
                }
            });
        });
    </script>
</head>

<body>
    <!-- Theme switcher toggle -->
    <div id="theme-switcher">
        <label class="switch">
            <input type="checkbox" id="theme-toggle">
            <span class="slider"></span>
        </label>
    </div>
    <!-- Page title -->
    <h1>Admin Login</h1>
    <!-- Error message display -->
    <p id="error-message" style="color: red; display: none;"></p>
    <!-- Admin login form -->
    <form id="login-form">
        <!-- Admin Username input -->
        <label for="username">Username:</label>
        <input type="text" id="username" name="username" required>
        <!-- Admin Password input -->
        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required>
        <!-- Submit button for login -->
        <button type="submit" style="background-color: green;" id="login-button">Log In</button>
        <!-- Button to go back to general login page -->
        <div class="button-row">
            <button type="button" style="background-color: red;" onclick="window.location.href='/LoginPage/LogInPage.html'">Back to Log In</button>
        </div>
    </form>
</body>
</html>