<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WCSS Tech Admin Member Management</title>
    <!-- Link to the default dark stylesheet -->
    <link rel="stylesheet" href="/CSS/DarkStyle.css">
    <!-- Favicon for the page -->
    <link rel="icon" type="image/x-icon" href="/FavIcon.ico">
    <style>
        body {
            display: flex;
            flex-direction: column;
        }

        .content {
            margin-left: 250px;
            padding: 20px;
        }
    </style>
    <!-- Theme handler script for switching themes -->
    <script src="/JS/themeHandler.js" defer></script>
    <!-- Authentication client script -->
    <script src="/JS/authClient.js" defer></script>
    <script>
        // Fetch and display the member list
        function loadMembers() {
            const apiBase = window.location.origin;
            // Fetch the list of members from the API
            fetch(`${apiBase}:5500/api/get-members`)
                .then(response => response.json())
                .then(data => {
                    const memberList = document.getElementById('member-list');
                    memberList.innerHTML = '';
                    // For each member, create a list item with a remove button
                    data.forEach(member => {
                        const listItem = document.createElement('li');
                        listItem.textContent = `${member.username}, ${member.job}`;
                        listItem.style.fontSize = '15px';

                        // Create the "Remove" button
                        const removeButton = document.createElement('button');
                        removeButton.textContent = 'Remove';
                        removeButton.style.marginTop = '10px';
                        removeButton.style.marginLeft = '10px';
                        removeButton.style.backgroundColor = 'red';
                        // Set up the remove button's click handler
                        removeButton.onclick = () => removeMember(member);

                        listItem.appendChild(removeButton);
                        memberList.appendChild(listItem);
                    });
                })
                .catch(error => console.error('Error fetching member list:', error));
        }

        // Remove a member
        function removeMember(member) {
            const trimmedMember = member.username; // Use the username property directly
            // Confirm removal with the user
            const confirmRemoval = confirm(`Are you sure you want to remove ${trimmedMember}?`);
            if (confirmRemoval) {
                const apiBase = window.location.origin;
                // Send a POST request to remove the member
                fetch(`${apiBase}:5500/remove-member`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ member: trimmedMember }), // Send only the username
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert(data.message);
                            location.reload(); // Reload the page to update the list
                        } else {
                            alert(`Error: ${data.error}`);
                        }
                    })
                    .catch(error => console.error('Error:', error));
            }
        }

        // Load members when the page loads
        window.onload = loadMembers;
    </script>
</head>

<body>
    <!-- Theme switcher toggle -->
    <div id="theme-switcher">
        <label class="switch">
            <input type="checkbox" id="theme-toggle">
            <span class="slider"></span>
        </label>
    </div>
    <!-- Sidebar navigation -->
    <div class="sidebar">
        <a href="AdminPage.html">Admin Main</a>
        <a href="AdminEventList.html">Event Management</a>
        <a href="AdminMemberManagment.html">Member Management</a>
        <a href="/AdminPage/AdminAnnouncements.html">Announcements</a>
        <a href="/UserPage/UserPage.html" onclick="signOut()">Sign Out</a>
    </div>
    <!-- Main content area -->
    <div class="content">
        <h1>Member Management</h1>
        <!-- List of members will be populated here -->
        <ul id="member-list"></ul>
        <!-- Button to add a new member -->
        <button onclick="window.location.href='AdminAddMember.html'">Add Member</button>
    </div>
</body>
</html>